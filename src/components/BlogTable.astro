---
import { getCollection } from 'astro:content';
import { INTL_SHORT } from '../consts';

const allPosts = await getCollection('blog');

const getDate = (post) => post.data.pubDate.getFullYear();
const grouped = Object.groupBy(allPosts, ({ data }) => data.pubDate.getFullYear());
const years = Object.keys(grouped).sort((yearA, yearB) => yearB - yearA);
---
<div class="group">
  {years.map(year => {
    const posts = grouped[year];
    return (
      <table class="border-collapse text-base font-normal animate-appear first:mt-0 mt-3" style="--stagger: 2;">
        <thead>
          <tr>
            <th class="border-b border-gray-500 text-end !font-light" colspan="2">{year}</th>
          </tr>
        </thead>
        <tbody class={ `peer/${year}` }>
          {posts.map(post => (
            <tr class="border-b text-black group-hover:text-slate-500 hover:!text-black transition-colors">
              <td class="p-0">
                <a href={`/blog/${post.slug}`} class="w-full block text-inherit">
                  {post.data.title}
                </a>
              </td>
              <td class="p-0 text-end">
                <a href={`/blog/${post.slug}`} class="w-full block text-inherit">
                  {INTL_SHORT.format(post.data.pubDate)}
                </a>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    );
  })}
</div>
